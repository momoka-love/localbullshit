<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>bullshit!</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --pink-1: #fff0f6;
      --pink-2: #ffd6e7;
      --accent: #ff84b1;
      --muted: #8f6b83;
      --white: #ffffff;
      --card-shadow: 0 8px 20px rgba(168, 92, 125, 0.12);
    }

    html, body {
      margin:0;
      padding:0;
      height:100%;
      font-family: "Poppins", sans-serif;
      background: linear-gradient(180deg, var(--pink-1), var(--pink-2));
      color:#53324b;
    }

    .app {
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
      box-sizing:border-box;
    }

    .card-shell{
      width:100%;
      max-width:1100px;
      background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.95));
      border-radius:20px;
      box-shadow: 0 12px 36px rgba(138,74,102,0.12);
      padding:22px;
      box-sizing:border-box;
      backdrop-filter: blur(6px);
    }

    header.app-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:18px;
    }

    .logo {
      display:flex;
      align-items:center;
      gap:12px;
    }

    .logo .mark{
      width:56px;
      height:56px;
      border-radius:12px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      color:var(--white);
      background: linear-gradient(135deg, #ff9cc7, #ff69a8);
      box-shadow: 0 6px 18px rgba(255,105,168,0.2);
      font-size:20px;
    }

    .logo h1{
      margin:0;
      font-size:20px;
      color:#3a2140;
    }

    .logo p{
      margin:0;
      font-size:12px;
      color:var(--muted);
    }

    #lobby-container{
      display:flex;
      gap:16px;
      align-items:center;
      justify-content:space-between;
      margin-bottom:18px;
      flex-wrap:wrap;
    }

    .input-row{
      display:flex;
      gap:12px;
      align-items:center;
      flex-wrap:wrap;
    }

    input[type="text"]{
      border:1px solid rgba(83,50,75,0.08);
      padding:12px 14px;
      border-radius:10px;
      font-size:14px;
      width:200px;
      background:transparent;
      outline:none;
      box-shadow:inset 0 1px 0 rgba(255,255,255,0.6);
    }

    button{
      background: linear-gradient(180deg, #ff79b3, #ff5b98);
      color:white;
      border:none;
      padding:10px 14px;
      border-radius:10px;
      font-weight:600;
      cursor:pointer;
      box-shadow: 0 8px 20px rgba(255,105,168,0.12);
    }

    button.secondary{
      background:transparent;
      color:#6a3b52;
      border:1px solid rgba(106,59,82,0.08);
      box-shadow:none;
    }

    .board{
      display:flex;
      gap:18px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
    }

    .left, .right{
      background: linear-gradient(180deg, rgba(255,255,255,0.7), rgba(255,255,255,0.9));
      border-radius:14px;
      padding:16px;
      box-sizing:border-box;
      box-shadow: var(--card-shadow);
    }

    .left{
      flex:1 1 60%;
      min-width:280px;
    }

    .right{
      width:300px;
      min-width:260px;
      display:flex;
      flex-direction:column;
      gap:12px;
      max-height:80vh; /* constrain panel height */
    }

    #game-container{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(78px, 1fr));
      gap:12px;
      align-items:start;
    }

    .card{
      background:white;
      border-radius:12px;
      padding:12px;
      text-align:center;
      font-weight:700;
      font-size:18px;
      color:#5b2a3f;
      border:1px solid rgba(83,50,75,0.06);
      box-shadow: 0 10px 26px rgba(153,86,120,0.08);
      cursor:pointer;
      user-select:none;
      transition:transform .14s ease, box-shadow .14s ease, background .14s ease;
    }

    .card.selected{
      transform:translateY(-8px) scale(1.04);
      box-shadow: 0 18px 36px rgba(168,92,125,0.18);
      background: linear-gradient(180deg,#fff #fff6fb);
      border:1px solid rgba(255,105,168,0.22);
    }

    .meta{
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:space-between;
      margin-bottom:12px;
    }

    .pile-box{
      border-radius:12px;
      padding:12px;
      min-height:92px;
      display:flex;
      flex-direction:column;
      gap:8px;
      align-items:flex-start;
      overflow-y:auto;
      max-height:120px; /* scrollable pile */
    }

    .pile-card{
      background: linear-gradient(180deg,#fff,#fff8f9);
      padding:8px 10px;
      border-radius:10px;
      width:100%;
      box-sizing:border-box;
      font-weight:600;
      color:#6a3b52;
      border:1px solid rgba(83,50,75,0.06);
      font-size:13px;
    }

    ul#players-list{
      list-style:none;
      padding:0;
      margin:0;
      display:flex;
      flex-direction:column;
      gap:8px;
      overflow-y:auto;
      max-height:120px; /* scrollable player list */
    }

    ul#players-list li{
      padding:8px 10px;
      background:rgba(255,255,255,0.6);
      border-radius:8px;
      border:1px solid rgba(83,50,75,0.04);
      font-weight:500;
      color:#513144;
    }

    .controls{
      display:flex;
      gap:8px;
      margin-top:12px;
      flex-wrap:wrap;
    }

    /* Chat */
    #chat-container{
      display:flex;
      flex-direction:column;
      flex:1 1 auto;
      border-radius:12px;
      background:rgba(255,255,255,0.6);
      border:1px solid rgba(83,50,75,0.08);
      overflow:hidden;
      min-height:120px;
    }

    #chat-messages{
      flex:1;
      padding:10px;
      overflow-y:auto;
      display:flex;
      flex-direction:column;
      gap:6px;
      font-size:13px;
      color:#513144;
    }

    .chat-message{
      background:white;
      padding:6px 10px;
      border-radius:8px;
      box-shadow:0 1px 2px rgba(0,0,0,0.06);
    }

    #chat-input-row{
      display:flex;
      border-top:1px solid rgba(83,50,75,0.08);
    }

    #chat-input-row input{
      flex:1;
      border:none;
      padding:10px;
      outline:none;
      background:transparent;
    }

    #chat-input-row button{
      padding:0 15px;
      border:none;
      background:#ff79b3;
      color:white;
      font-weight:600;
      cursor:pointer;
    }

    #bs-banner{
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      top:20px;
      background: linear-gradient(90deg,#ff89bb,#ff5aa0);
      color:white;
      padding:10px 18px;
      border-radius:20px;
      font-weight:700;
      display:none;
      box-shadow: 0 10px 30px rgba(255,90,140,0.18);
      z-index:9999;
    }

    @media (max-width:800px){
      .board{ flex-direction:column; }
      .right{ width:100%; max-height:none; }
    }
  </style>
</head>

<body>
  <div id="bs-banner">bullshit!</div>

  <div class="app">
    <div class="card-shell">

      <header class="app-header">
        <div class="logo">
          <div class="mark">BS!</div>
          <div>
            <h1>bullshit!</h1>
            <p>local lobby play</p>
          </div>
        </div>
        <div style="display:flex;gap:12px;align-items:center;">
          <button class="secondary" id="btn-leave">Leave</button>
        </div>
      </header>

      <!-- LOBBY -->
      <div id="lobby-container">
        <div class="input-row">
          <input id="player-name" type="text" placeholder="your name" />
          <input id="lobby-name" type="text" placeholder="lobby name" />
          <button id="btn-join">join lobby</button>
        </div>
      </div>

      <!-- GAME -->
      <div id="game-container-wrapper" style="display:none;">
        <div class="board">
          <div class="left">
            <div class="meta">
              <div>
                <div id="game-info">current turn: —</div>
              </div>
              <div style="text-align:right;">
                <div>player hand</div>
                <div id="player-name-display">—</div>
              </div>
            </div>
            <div id="game-container" aria-live="polite"></div>
            <div class="controls">
              <button id="btn-play">play selected</button>
              <button id="btn-draw" class="secondary">draw</button>
              <button id="btn-bullshit">bullshit!</button>
            </div>
          </div>

          <div class="right">
            <h3>pile</h3>
            <div id="pile-container" class="pile-box"></div>

            <h3>players</h3>
            <ul id="players-list"></ul>

            <h3>chat</h3>
            <div id="chat-container">
              <div id="chat-messages"></div>
              <div id="chat-input-row">
                <input type="text" id="chat-input" placeholder="type a message..." />
                <button id="chat-send">send</button>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script>
  const firebaseConfig = {
    apiKey: "AIzaSyDuRUwCmQCoSJTMvwqaY4Hj-SPv4WCHWpQ",
    authDomain: "bullshit-f4f8e.firebaseapp.com",
    databaseURL: "https://bullshit-f4f8e-default-rtdb.firebaseio.com",
    projectId: "bullshit-f4f8e",
    storageBucket: "bullshit-f4f8e.appspot.com",
    messagingSenderId: "497908378251",
    appId: "1:497908378251:web:8f93b8a4d1d27539b2c28e"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const suits = ['♠','♥','♦','♣'];
  const ranks = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];

  let playerName="", lobbyName="", lobbyRef=null;
  let playerHand=[], pile=[], currentTurn="", joined=false;
  let selectedCards=new Set();
  let lobbyUnsub=null;

  function randomCard(){ return ranks[Math.floor(Math.random()*ranks.length)] + suits[Math.floor(Math.random()*suits.length)]; }
  function getNextRank(lastRank){ if(!lastRank) return ranks[0]; return ranks[(ranks.indexOf(lastRank)+1)%ranks.length]; }

  function showBullshitBanner(msg){
    const banner=document.getElementById('bs-banner');
    banner.textContent=msg;
    banner.style.display='block';
    setTimeout(()=>{ banner.style.display='none'; }, 2200);
  }

  // ---- Chat ----
  const chatRef = () => lobbyRef ? lobbyRef.child('chat') : null;
  function addChatMessage(msg){
    const container=document.getElementById('chat-messages');
    const div=document.createElement('div');
    div.className='chat-message';
    div.innerHTML=`<strong>${msg.player}:</strong> ${msg.text}`;
    container.appendChild(div);
    container.scrollTop = container.scrollHeight;
  }
  function initChat(){
    if(!lobbyRef) return;
    const ref = chatRef();
    ref.on('child_added', snapshot => {
      const msg = snapshot.val();
      addChatMessage(msg);
    });
  }
  function sendMessage(){
    const input=document.getElementById('chat-input');
    const text=input.value.trim();
    if(!text || !lobbyRef) return;
    chatRef().push({player:playerName, text});
    input.value='';
  }
  document.getElementById('chat-send').onclick = sendMessage;
  document.getElementById('chat-input').addEventListener('keydown', e => { if(e.key==='Enter') sendMessage(); });

  // ---- Game Logic ----
  function joinLobby(){
    playerName=document.getElementById('player-name').value.trim();
    lobbyName=document.getElementById('lobby-name').value.trim();
    if(!playerName||!lobbyName){ alert("Enter name and lobby"); return; }

    lobbyRef=db.ref('lobbies/'+lobbyName);

    lobbyRef.transaction(game=>{
      if(!game) game={players:{}, pile:[], currentTurn:playerName, winner:null};
      game.players=game.players||{};
      if(!game.players[playerName]) game.players[playerName]=Array.from({length:5},()=>randomCard());
      playerHand=game.players[playerName].slice();
      game.currentTurn=game.currentTurn||playerName;
      return game;
    }).then(()=>{
      joined=true;
      document.getElementById('lobby-container').style.display='none';
      document.getElementById('game-container-wrapper').style.display='block';
      document.getElementById('player-name-display').textContent=playerName;

      if(lobbyUnsub) lobbyRef.off('value', lobbyUnsub);
      lobbyUnsub=lobbyRef.on('value', snapshot=>{
        const game=snapshot.val()||{};
        pile=game.pile||[];
        currentTurn=game.currentTurn||"";
        if(game.players && game.players[playerName]) playerHand=game.players[playerName].slice();
        updateUI(game.players||{}, game.winner||null);
        if(game.winner) showBullshitBanner(`${game.winner} wins!`);
      });

      initChat();
    });
  }

  function updateUI(players={}, winner=null){
    const container=document.getElementById('game-container');
    container.innerHTML='';
    playerHand.forEach((c,i)=>{
      const div=document.createElement('div');
      div.textContent=c; div.className='card';
      if(selectedCards.has(i)) div.classList.add('selected');
      div.onclick=()=>{ if(selectedCards.has(i)) selectedCards.delete(i); else selectedCards.add(i); updateUI(); };
      container.appendChild(div);
    });

    const pileContainer=document.getElementById('pile-container');
    pileContainer.innerHTML='';
    pile.slice().reverse().forEach(p=>{
      const div=document.createElement('div');
      div.textContent=(p.player===playerName)?`${p.card} (${p.declared})`:`${p.declared} (by ${p.player})`;
      div.className='pile-card';
      pileContainer.appendChild(div);
    });

    const list=document.getElementById('players-list');
    list.innerHTML='';
    Object.entries(players).forEach(([name,hand])=>{
      const li=document.createElement('li');
      li.textContent=`${name} - ${hand.length} card${hand.length!==1?'s':''}`;
      if(name===currentTurn) li.style.fontWeight='bold';
      if(hand.length===0) li.style.textDecoration='underline';
      list.appendChild(li);
    });

    document.getElementById('game-info').textContent=`Current Turn: ${currentTurn || '—'}`;
    document.getElementById('btn-play').disabled=!joined||currentTurn!==playerName||winner;
    document.getElementById('btn-draw').disabled=!joined||currentTurn!==playerName||winner;
    document.getElementById('btn-bullshit').disabled=!joined||pile.length===0||winner;
  }

  document.getElementById('btn-join').onclick = joinLobby;

  </script>
</body>
</html>
