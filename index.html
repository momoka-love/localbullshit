<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bullshit — Redesigned UI</title>

<!-- Firebase (v8 namespaced, compatible with your original code style) -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<style>
  :root{
    --bg:#0f1724; --card:#ffffff; --muted:#98a0b3; --accent:#4fd1c5;
    --danger:#ff6b6b; --panel:#0b1220;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial; background:linear-gradient(180deg,#071025 0%, #07172b 100%); color:#e6eef6}
  .app{max-width:1100px;margin:18px auto;padding:18px;display:grid;grid-template-columns:320px 1fr;gap:18px;}
  .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:14px;border-radius:12px; box-shadow: 0 6px 18px rgba(3,10,20,0.6); }
  h1{margin:0 0 12px 0;font-size:18px}
  label{display:block;color:var(--muted);font-size:12px;margin-top:8px}
  input[type=text]{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:#081324;color:inherit}
  button{padding:8px 12px;border-radius:8px;border:none;background:var(--accent);color:#042024;cursor:pointer}
  button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
  .small{font-size:13px;padding:6px 10px}
  .players-list{list-style:none;padding:0;margin:8px 0 0 0}
  .players-list li{padding:8px;border-radius:8px;margin-bottom:6px;background:rgba(255,255,255,0.02);display:flex;justify-content:space-between;align-items:center}
  .players-list li.turn{outline:2px solid rgba(79,209,197,0.12);background:linear-gradient(90deg, rgba(79,209,197,0.03), transparent)}
  .players-list li.you{font-weight:600}
  .game-area{display:flex;flex-direction:column;gap:12px}
  .board{display:flex;gap:12px;align-items:flex-start}
  .hand{display:flex;flex-wrap:wrap;gap:8px;padding:8px;background:rgba(255,255,255,0.02);border-radius:10px;min-height:88px}
  .card{min-width:56px;height:80px;border-radius:8px;background:linear-gradient(180deg,#fff,#f3f6ff);color:#042024;display:flex;align-items:center;justify-content:center;font-weight:700;cursor:pointer;box-shadow:0 6px 12px rgba(2,8,20,0.6)}
  .card.selected{transform:translateY(-8px) scale(1.02);box-shadow:0 14px 28px rgba(2,8,20,0.6)}
  #pile{min-width:120px;min-height:120px;padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);display:flex;align-items:center;justify-content:center;position:relative}
  .pile-card{position:absolute;padding:6px 8px;border-radius:6px;background:#fff;color:#042024;font-weight:700;box-shadow:0 10px 20px rgba(2,8,20,0.6);transform-origin:left top}
  .controls{display:flex;gap:8px;align-items:center}
  .chat{height:240px;overflow:auto;padding:8px;background:rgba(6,12,20,0.4);border-radius:10px}
  .notify{position:fixed;right:18px;bottom:18px;background:var(--panel);padding:10px;border-radius:10px;color:var(--accent);box-shadow:0 8px 30px rgba(0,0,0,0.6)}
  .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
  .turn-indicator{padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);font-weight:600}
  .winner{padding:8px;background:linear-gradient(90deg,#ffd27a,#ffb86b);color:#331b00;border-radius:8px;font-weight:700}
  .modal-back{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center}
  .modal{background:#071726;padding:18px;border-radius:12px;min-width:320px}
  .muted{color:var(--muted);font-size:13px}
  @media(max-width:880px){
    .app{grid-template-columns:1fr; padding:12px}
    .panel{order:2}
  }
</style>
</head>
<body>

<div class="app">
  <!-- LEFT PANEL: Join / Players / Chat -->
  <div class="panel" id="left-panel">
    <h1>Bullshit — Lobby</h1>

    <div id="join-panel">
      <label>Player name</label>
      <input id="player-name" type="text" placeholder="Your name (e.g. Sam)"/>
      <label>Lobby name</label>
      <input id="lobby-name" type="text" placeholder="Lobby ID (e.g. myroom)"/>
      <div style="display:flex;gap:8px;margin-top:10px">
        <button id="btn-join">Join</button>
        <button id="btn-leave" class="secondary" disabled>Leave</button>
      </div>
      <p class="muted" id="join-status">Not connected</p>
    </div>

    <hr style="border:none;height:8px;opacity:0.02"/>

    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong>Players</strong>
      <span class="muted" id="player-count">0</span>
    </div>
    <ul class="players-list" id="players-list"></ul>

    <div style="margin-top:10px">
      <strong>Chat</strong>
      <div class="chat" id="chat-messages"></div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <input id="chat-input" type="text" placeholder="Say something..." />
        <button id="chat-send" class="small">Send</button>
      </div>
    </div>
  </div>

  <!-- RIGHT PANEL: Game area -->
  <div class="panel game-area">
    <div class="topbar">
      <div>
        <div class="turn-indicator" id="game-info">Current Turn: —</div>
        <div class="muted" id="lobby-tag">Lobby: —</div>
      </div>
      <div id="winner-banner"></div>
    </div>

    <div class="board">
      <div style="flex:1;">
        <h3 style="margin:6px 0 8px 0">Your Hand</h3>
        <div id="hand" class="hand" aria-live="polite"></div>

        <div style="display:flex;align-items:center;margin-top:12px;gap:10px">
          <div class="controls">
            <button id="btn-play" class="small" disabled>Play Selected</button>
            <button id="btn-draw" class="small" disabled>Draw</button>
            <button id="btn-bullshit" class="small" disabled>Call Bullshit</button>
          </div>
          <div id="declared-note" class="muted">Select cards, then Play</div>
        </div>
      </div>

      <div style="width:260px;">
        <h3 style="margin:6px 0 8px 0">Pile</h3>
        <div id="pile" aria-live="polite"></div>
        <div style="margin-top:10px" class="muted" id="pile-count">0 cards</div>
      </div>
    </div>

    <div>
      <h3 style="margin:8px 0">Game Controls</h3>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button id="btn-play-again" class="secondary small" disabled>Play Again</button>
        <button id="btn-reset-lobby" class="secondary small" disabled>Reset Lobby (host)</button>
      </div>
    </div>
  </div>
</div>

<!-- Notification -->
<div id="site-notification" class="notify" style="display:none"></div>

<!-- Modal area (declaring rank) -->
<div id="modal-root" style="display:none"></div>

<script>
/* -------------------------
   Firebase config (yours)
   ------------------------- */
const firebaseConfig = {
  apiKey: "AIzaSyDuRUwCmQCoSJTMvwqaY4Hj-SPv4WCHWpQ",
  authDomain: "bullshit-f4f8e.firebaseapp.com",
  databaseURL: "https://bullshit-f4f8e-default-rtdb.firebaseio.com",
  projectId: "bullshit-f4f8e",
  storageBucket: "bullshit-f4f8e.appspot.com",
  messagingSenderId: "497908378251",
  appId: "1:497908378251:web:8f93b8a4d1d27539b2c28e"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* -------------------------
   Game variables & constants
   ------------------------- */
const suits = ['♠','♥','♦','♣'];
const ranks = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];

let playerName = "", lobbyName = "", lobbyRef = null, messagesRef = null;
let lobbyUnsub = null, chatUnsub = null;
let playerHand = [], pile = [], currentTurn = "", playerOrder = [];
let joined = false;
let selectedCards = new Set();
let txPending = false;

/* -------------------------
   UI helpers
   ------------------------- */
function showNotification(msg){
  const n = document.getElementById('site-notification');
  n.textContent = msg;
  n.style.display = 'block';
  setTimeout(()=>{ n.style.display='none'; }, 3000);
}

function setJoinState(isJoined){
  document.getElementById('btn-join').disabled = isJoined;
  document.getElementById('btn-leave').disabled = !isJoined;
  document.getElementById('chat-send').disabled = !isJoined;
  document.getElementById('chat-input').disabled = !isJoined;
  document.getElementById('btn-play-again').disabled = !isJoined;
  document.getElementById('btn-reset-lobby').disabled = !isJoined;
}

/* -------------------------
   Utility: random card
   ------------------------- */
function randomCard(){
  const r = ranks[Math.floor(Math.random()*ranks.length)];
  const s = suits[Math.floor(Math.random()*suits.length)];
  return r + s;
}
function getNextRank(lastRank){
  if(!lastRank) return ranks[0];
  const idx = ranks.indexOf(lastRank);
  return ranks[(idx+1)%ranks.length];
}

/* -------------------------
   Modal: Declare rank (returns Promise)
   ------------------------- */
function promptDeclare(requiredRank, defaultRank){
  return new Promise(resolve=>{
    const root = document.getElementById('modal-root');
    root.innerHTML = '';
    root.style.display = 'flex';
    const back = document.createElement('div');
    back.className = 'modal-back';
    const modal = document.createElement('div');
    modal.className = 'modal';
    const title = document.createElement('h3');
    title.textContent = 'Declare Rank';
    const note = document.createElement('div');
    note.className = 'muted';
    note.textContent = requiredRank ? `You must declare ${requiredRank}` : 'Declare any rank';
    const sel = document.createElement('select');
    sel.style.width='100%';
    sel.style.marginTop='8px';
    ranks.forEach(r=>{ const opt=document.createElement('option'); opt.value=r; opt.textContent=r; sel.appendChild(opt); });
    if(requiredRank) sel.value = requiredRank;
    else sel.value = defaultRank || ranks[0];

    const btns = document.createElement('div');
    btns.style.display='flex'; btns.style.gap='8px'; btns.style.marginTop='12px';
    const ok = document.createElement('button'); ok.textContent='Confirm';
    const cancel = document.createElement('button'); cancel.textContent='Cancel'; cancel.className='secondary';

    ok.onclick = ()=>{ root.style.display='none'; resolve(sel.value); };
    cancel.onclick = ()=>{ root.style.display='none'; resolve(null); };

    btns.appendChild(ok); btns.appendChild(cancel);
    modal.appendChild(title); modal.appendChild(note); modal.appendChild(sel); modal.appendChild(btns);
    back.appendChild(modal);
    root.appendChild(back);
  });
}

/* -------------------------
   Join Lobby (adds playerOrder)
   ------------------------- */
async function joinLobby(){
  playerName = document.getElementById('player-name').value.trim();
  lobbyName = document.getElementById('lobby-name').value.trim();
  if(!playerName || !lobbyName) return alert('Enter name and lobby');

  lobbyRef = db.ref('lobbies/'+lobbyName);
  messagesRef = lobbyRef.child('messages');

  try{
    // Transactionally add player and ensure playerOrder exists & contains this player
    await lobbyRef.transaction(game=>{
      if(!game) game = { players:{}, pile:[], currentTurn:playerName, playerOrder:[], winner:null, messages:{} };
      game.players = game.players || {};
      game.pile = game.pile || [];
      game.playerOrder = game.playerOrder || [];

      // Add this player if missing
      if(!game.players[playerName]){
        const hand = Array.from({length:5}, ()=>randomCard());
        game.players[playerName] = hand;
      }
      // Ensure playerOrder contains this player (preserve join order)
      if(!game.playerOrder.includes(playerName)) game.playerOrder.push(playerName);

      // Ensure currentTurn is valid
      if(!game.currentTurn) game.currentTurn = game.playerOrder[0] || playerName;
      return game;
    });

    // set flags
    joined = true;
    document.getElementById('lobby-container')?.remove?.(); // no-op if not present
    document.getElementById('lobby-tag').textContent = `Lobby: ${lobbyName}`;
    setJoinState(true);

    // Unsubscribe previous listeners
    if(lobbyUnsub) lobbyRef.off('value', lobbyUnsub);
    if(chatUnsub) messagesRef.off('child_added', chatUnsub);

    // Listen to lobby changes
    lobbyUnsub = lobbyRef.on('value', snapshot=>{
      const game = snapshot.val() || {};
      pile = game.pile || [];
      currentTurn = game.currentTurn || '';
      playerOrder = game.playerOrder || Object.keys(game.players || {});
      if(game.players && game.players[playerName]) playerHand = game.players[playerName].slice();
      updateUI(game.players || {}, game.winner || null);
      if(game.winner) showNotification(`${game.winner} wins the game!`);
      document.getElementById('join-status').textContent = `Connected to ${lobbyName}`;
    });

    // Chat
    chatUnsub = messagesRef.on('child_added', snap=>{
      const msg = snap.val(); if(!msg) return;
      const chat = document.getElementById('chat-messages');
      const div = document.createElement('div');
      const time = new Date(msg.timestamp).toLocaleTimeString();
      div.textContent = `[${time}] ${msg.player}: ${msg.text}`;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
      if(chat.childNodes.length > 200) chat.removeChild(chat.firstChild);

      if(msg.text.toLowerCase().includes("bullshit")) showNotification(`${msg.player} called Bullshit!`);
    });

    showNotification('Joined lobby: ' + lobbyName);

  }catch(err){
    console.error(err);
    alert('Failed to join: ' + (err.message||err));
  }
}

/* -------------------------
   Toggle card selection
   ------------------------- */
function toggleCard(index){
  if(selectedCards.has(index)) selectedCards.delete(index);
  else selectedCards.add(index);
  updateUI();
}

/* -------------------------
   Safer Play Selected (server-side hand usage)
   ------------------------- */
async function playSelected(){
  if(!joined) return alert("Not in a lobby!");
  if(currentTurn !== playerName) return alert("Not your turn!");
  if(selectedCards.size === 0) return alert("Select cards!");

  if(txPending) return; // prevent double-tap
  txPending = true;
  updateButtons();

  // stable sorted indices array
  const indices = [...selectedCards].map(i => Number(i)).sort((a,b)=>a-b);

  // client preview for default declared
  const cardsPreview = indices.map(i => playerHand[i]).filter(Boolean);
  const lastDeclared = pile.length ? pile[pile.length-1].declared : null;
  const requiredDeclared = lastDeclared ? getNextRank(lastDeclared) : null;

  // prompt for declared rank via modal
  const declaredRank = await promptDeclare(requiredDeclared, requiredDeclared || (cardsPreview[0] ? cardsPreview[0].slice(0,-1) : ranks[0]));
  if(declaredRank === null){
    txPending = false;
    updateButtons();
    return; // cancelled
  }

  try{
    const res = await lobbyRef.transaction(game=>{
      if(!game) return game; // abort if missing
      game.players = game.players || {};
      game.pile = game.pile || [];
      game.playerOrder = game.playerOrder || [];

      // only proceed if it's still the player's turn
      if(game.currentTurn !== playerName) return game;

      const hand = (game.players[playerName] || []).slice();

      // validate indices
      if(indices.some(i => i < 0 || i >= hand.length)) {
        console.warn("Index mismatch inside transaction — aborting play");
        return game; // some other client changed hand: abort safe
      }

      const playedCards = indices.map(i => hand[i]);

      // build newHand (remove selected indices)
      const newHand = hand.filter((_, idx) => !indices.includes(idx));
      game.players[playerName] = newHand;

      // push to pile
      playedCards.forEach(c => game.pile.push({ card: c, declared: declaredRank, player: playerName }));

      // winner check
      if(newHand.length === 0) game.winner = playerName;

      // advance turn using playerOrder if present, else keys sorted
      const order = (game.playerOrder && game.playerOrder.length) ? game.playerOrder : Object.keys(game.players).sort();
      let idx = order.indexOf(game.currentTurn);
      if(idx === -1) idx = 0;
      // pick next existing player: skip players not in game.players map (they may have left)
      for(let i=1;i<=order.length;i++){
        const candidate = order[(idx + i) % order.length];
        if(game.players && game.players.hasOwnProperty(candidate)) {
          game.currentTurn = candidate;
          break;
        }
      }
      return game;
    });

    if(res && res.committed){
      // success
      selectedCards.clear();
    } else {
      showNotification('Play aborted (race condition). Try again.');
    }
  }catch(err){
    console.error(err);
    alert('Play failed: ' + (err.message||err));
  } finally {
    txPending = false;
    updateButtons();
  }
}

/* -------------------------
   Draw card (atomic)
   ------------------------- */
async function drawCard(){
  if(!joined || currentTurn !== playerName) return alert("Not your turn or not in lobby");
  if(txPending) return;
  txPending = true;
  updateButtons();
  const newCard = randomCard();
  try{
    await lobbyRef.child('players').child(playerName).transaction(hand=>{
      hand = hand || [];
      hand.push(newCard);
      return hand;
    });
  }catch(err){ console.error(err); showNotification('Draw failed'); }
  txPending = false;
  updateButtons();
}

/* -------------------------
   Call Bullshit
   ------------------------- */
async function callBS(){
  if(!joined || pile.length === 0) return;
  if(txPending) return;
  txPending = true;
  updateButtons();
  try{
    const res = await lobbyRef.transaction(game=>{
      if(!game || !game.pile) return game;
      game.players = game.players || {};
      // last pile item
      const last = game.pile[game.pile.length - 1];
      const realRank = last.card.slice(0, -1);
      const pileCards = game.pile.map(p=>p.card);
      if(realRank === last.declared){
        // caller mistaken -> caller takes pile
        game.players[playerName] = (game.players[playerName] || []).concat(pileCards);
      } else {
        // last player lied -> they take pile
        game.players[last.player] = (game.players[last.player] || []).concat(pileCards);
      }
      game.pile = [];
      game.currentTurn = playerName;
      return game;
    });
    showNotification(`${playerName} called Bullshit!`);
  }catch(err){
    console.error(err); showNotification('Bullshit call failed');
  } finally {
    txPending = false;
    updateButtons();
  }
}

/* -------------------------
   Send Chat
   ------------------------- */
function sendMessage(){
  const input = document.getElementById('chat-input');
  const text = input.value.trim();
  if(!text || !joined) return;
  messagesRef.push({ player: playerName, text, timestamp: Date.now() });
  input.value = '';
}

/* -------------------------
   Update UI (render)
   ------------------------- */
function updateUI(playersObj = {}, winner = null){
  // Hand UI
  const handDiv = document.getElementById('hand');
  handDiv.innerHTML = '';
  playerHand.forEach((c,i)=>{
    const d = document.createElement('div');
    d.className = 'card' + (selectedCards.has(i)?' selected':'');
    d.textContent = c;
    d.setAttribute('data-index', i);
    d.onclick = ()=>{ toggleCard(i); };
    handDiv.appendChild(d);
  });

  // Pile
  const pileDiv = document.getElementById('pile');
  pileDiv.innerHTML = '';
  pile.forEach((p, i) => {
    const d = document.createElement('div');
    d.className = 'pile-card';
    const text = (p.player === playerName) ? `${p.card} (${p.declared})` : `${p.declared} (by ${p.player})`;
    d.textContent = text;
    d.style.transform = `translate(${i*3}px, ${-i*2}px) rotate(${(i%7)-3}deg)`;
    d.style.zIndex = i;
    pileDiv.appendChild(d);
  });
  document.getElementById('pile-count').textContent = `${pile.length} card${pile.length !== 1 ? 's' : ''}`;

  // Players list: use playerOrder if available
  const list = document.getElementById('players-list');
  list.innerHTML = '';
  const order = playerOrder && playerOrder.length ? playerOrder : Object.keys(playersObj).sort();
  order.forEach(name => {
    const hand = playersObj[name] || [];
    const li = document.createElement('li');
    li.textContent = `${name} - ${hand.length} card${hand.length !== 1 ? 's' : ''}`;
    if(name === currentTurn) li.classList.add('turn');
    if(name === playerName) li.classList.add('you');
    if(hand.length === 0) li.style.textDecoration = 'underline';
    list.appendChild(li);
  });
  document.getElementById('player-count').textContent = order.length;

  // Game info and buttons
  document.getElementById('game-info').textContent = `Current Turn: ${currentTurn || '—'}`;
  document.getElementById('btn-play').disabled = !joined || currentTurn !== playerName || !!winner || txPending;
  document.getElementById('btn-draw').disabled = !joined || currentTurn !== playerName || !!winner || txPending;
  document.getElementById('btn-bullshit').disabled = !joined || pile.length === 0 || !!winner || txPending;
  document.getElementById('btn-play-again').disabled = !joined || txPending;
  document.getElementById('btn-reset-lobby').disabled = !joined || txPending;

  // Winner banner
  const banner = document.getElementById('winner-banner');
  if(winner){
    banner.innerHTML = `<div class="winner">${winner === playerName ? '🎉 You Win!' : '🏆 ' + winner + ' Wins!'}</div>`;
  } else banner.innerHTML = '';

  // declared note
  document.getElementById('declared-note').textContent =
    selectedCards.size ? `Selected ${selectedCards.size} card(s)` : 'Select cards, then Play';
}

/* -------------------------
   Play Again (reset hands)
   ------------------------- */
async function playAgain(){
  if(!joined) return;
  try{
    await lobbyRef.transaction(game=>{
      if(!game) return game;
      const players = game.players || {};
      for(let name in players){
        players[name] = Array.from({length:5}, ()=>randomCard());
      }
      game.players = players;
      game.pile = [];
      game.winner = null;
      game.currentTurn = (game.playerOrder && game.playerOrder[0]) || Object.keys(players)[0] || null;
      return game;
    });
  }catch(err){ console.error(err); showNotification('Play again failed'); }
}

/* -------------------------
   Reset lobby (clear everything) — host-only chooser
   ------------------------- */
async function resetLobby(){
  if(!joined) return;
  if(!confirm('Reset entire lobby? This clears all players and pile.')) return;
  try{
    await lobbyRef.set({ players: {}, pile: [], playerOrder: [], currentTurn: null, winner: null, messages: {} });
  }catch(err){ console.error(err); showNotification('Reset failed'); }
}

/* -------------------------
   Leave lobby
   ------------------------- */
async function leaveLobby(){
  if(!joined) return;
  try{
    if(lobbyUnsub) lobbyRef.off('value', lobbyUnsub);
    if(chatUnsub) messagesRef.off('child_added', chatUnsub);
    // remove player and playerOrder entry
    await lobbyRef.transaction(game=>{
      if(!game) return game;
      game.players = game.players || {};
      game.playerOrder = game.playerOrder || [];
      delete game.players[playerName];
      game.playerOrder = game.playerOrder.filter(n => n !== playerName);
      // if no players left, clear some fields
      if(Object.keys(game.players).length === 0){
        game.pile = [];
        game.winner = null;
        game.currentTurn = null;
      } else {
        if(game.currentTurn === playerName){
          // advance to next
          const order = game.playerOrder.length ? game.playerOrder : Object.keys(game.players);
          game.currentTurn = order[0] || Object.keys(game.players)[0];
        }
      }
      return game;
    });
  }catch(e){ console.warn(e); }
  // local cleanup
  joined = false;
  playerName = ''; lobbyName = ''; lobbyRef = null; messagesRef = null;
  playerHand = []; pile = []; currentTurn = ''; playerOrder = []; selectedCards.clear();
  setJoinState(false);
  document.getElementById('player-name').value = '';
  document.getElementById('lobby-name').value = '';
  document.getElementById('join-status').textContent = 'Not connected';
  updateUI({}, null);
  showNotification('Left lobby');
}

/* -------------------------
   Wiring UI
   ------------------------- */
document.getElementById('btn-join').onclick = joinLobby;
document.getElementById('btn-leave').onclick = leaveLobby;
document.getElementById('chat-send').onclick = sendMessage;
document.getElementById('chat-input').addEventListener('keypress', e=>{ if(e.key==='Enter') sendMessage(); });

document.getElementById('btn-play').onclick = playSelected;
document.getElementById('btn-draw').onclick = drawCard;
document.getElementById('btn-bullshit').onclick = callBS;
document.getElementById('btn-play-again').onclick = playAgain;
document.getElementById('btn-reset-lobby').onclick = resetLobby;

/* -------------------------
   Helpers: update button states when tx pending
   ------------------------- */
function updateButtons(){
  document.getElementById('btn-play').disabled = !joined || currentTurn !== playerName || txPending;
  document.getElementById('btn-draw').disabled = !joined || currentTurn !== playerName || txPending;
  document.getElementById('btn-bullshit').disabled = !joined || pile.length === 0 || txPending;
  document.getElementById('btn-play-again').disabled = !joined || txPending;
  document.getElementById('btn-reset-lobby').disabled = !joined || txPending;
}

/* -------------------------
   Initial render
   ------------------------- */
updateUI();
setJoinState(false);

// expose for debugging in console
window._game = { joinLobby, leaveLobby, playSelected, drawCard, callBS, db };
</script>
</body>
</html>
